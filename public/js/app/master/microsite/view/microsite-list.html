<header id="header" data-current-skin={{mactrl.currentSkin}} data-ng-include src="'/template/header.html'"
        data-ng-controller="headerCtrl as hctrl"></header>

<section id="main">
    <aside id="sidebar" data-ng-include src="'/template/sidebar-left.html'"
           data-ng-class="{ 'toggled': mactrl.sidebarToggle.left === true }"></aside>

    <aside id="chat" data-ng-include src="'/template/chat.html'"
           data-ng-class="{ 'toggled': mactrl.sidebarToggle.right === true }"></aside>

    <section id="content" class="page-view">
        <div class="container">
            <div class="block-header">

                <h3>Micrositios y Microportales</h3>


            </div>
            <div class="card">
                <div class="card-header">
                    Total Visitas: <span>{{vm.counters.totalVisits}}</span>

                    <div class="pull-right">
                        <button class="btn btn-danger waves-effect"
                                ui-sref="bs-new-microsite">
                            <i class="zmdi zmdi-plus zmdi-hc-fw"></i>
                            Nuevo micrositio
                        </button>

                        <button class="btn btn-primary waves-effect"
                                ui-sref="new-microportal">
                            <i class="zmdi zmdi-plus zmdi-hc-fw"></i>
                            Nuevo microportal
                        </button>
                    </div>
                </div>
                <div class="card-body">
                    <tabset>
                        <tab heading="Micrositios" active="true">
                            <div class="table-responsive">
                                <table class="table table-striped table-vmiddle">
                                    <thead>
                                    <tr>
                                        <th>Logo</th>
                                        <th>Nombre</th>
                                        <th>Dominio</th>
                                        <th>Categoría</th>
                                        <th>Sub Categoría</th>
                                        <th ng-class="(vm.orderHighVisits==2?'':'dropup')" style="cursor: pointer;"
                                            ng-click="vm.orderByVisit()">Conversiones <span class="caret"></span></th>
                                        <th></th>
                                    </tr>
                                    <tr>
                                        <td></td>
                                        <td>
                                            <form class="fg-line" ng-submit="vm.search()">
                                                <input type="text" ng-model="vm.filters.name.value"
                                                       class="form-control input-sm"/>
                                            </form>
                                        </td>
                                        <td>
                                            <form class="fg-line" ng-submit="vm.search()">
                                                <input type="text" ng-model="vm.filters.domain.value"
                                                       class="form-control input-sm">
                                            </form>
                                        </td>
                                        <td>
                                            <form class="fg-line" ng-submit="vm.search()">
                                                <input type="text" ng-model="vm.filters.category.value"
                                                       class="form-control input-sm">
                                            </form>
                                        </td>
                                        <td>
                                            <form class="fg-line" ng-submit="vm.search()">
                                                <input type="text" ng-model="vm.filters.subcategory.value"
                                                       class="form-control input-sm">
                                            </form>
                                        </td>
                                        <td>
                                            <div class="fg-line">
                                                <input date-range-picker class="form-control date-picker"
                                                       type="text" readonly style="background: white;"
                                                       ng-model="vm.count_filter_selected"
                                                       options="vm.datepickerOptions"/>
                                            </div>
                                        </td>
                                        <td></td>
                                    </tr>
                                    </thead>
                                    <tbody bs-loading-overlay="ms-table-overlay"
                                           bs-loading-overlay-template-url="overlay-template.html">
                                    <!--<tr>-->
                                    <!--<td colspan="6" ng-show="vm.flags.isLoading && !vm.flags.serverError"-->
                                    <!--class="text-center">-->
                                    <!--Cargando Datos...-->
                                    <!--</td>-->
                                    <!--</tr>-->
                                    <tr>
                                        <td colspan="6" ng-show="vm.flags.serverError" class="text-center">Hubo un error
                                            interno
                                        </td>
                                    </tr>
                                    <tr>
                                        <td colspan="6" ng-show="vm.microsites.length == 0 && !vm.flags.serverError"
                                            class="text-center">
                                            No se encontraron resultados
                                        </td>
                                    </tr>
                                    <tr ng-repeat="item in vm.microsites" ng-show="!vm.flags.serverError"
                                        ng-init="flagctg=false;flagsubctg=false">
                                        <td>
                                            <img ng-src="{{(item.image_logo!=null?vm.ms_route_img+item.image_logo:(item.categories.length>0?vm.ctg_route_img+item.categories[0].image_logo:null))}}"
                                                 alt=""/>
                                        </td>
                                        <td>{{item.name}} <i
                                                ng-class="(item.site_name!=null?'zmdi zmdi-star zmdi-hc-fw':null)"></i>
                                        </td>
                                        <td>
                                            <a href="//{{(item.domain?item.domain+'/'+item.site_name:vm.url_main_domain+(item.site_name?item.site_name:item.sitename_free+'-'))}}"
                                               target="_blank">
                                                {{(item.domain?item.domain+"/"+item.site_name:vm.url_main_domain+(item.site_name?item.site_name:item.sitename_free+"-"))}}
                                            </a>
                                        </td>
                                        <td>
                                            <span ng-show="item.categories.length==0">-</span>

                                            <div ng-repeat="ctg in item.categories" ng-show="$index==0 || flagctg">
                                                {{ctg.name}}
                                            </div>
                                            <a href="javascript:" ng-show="item.categories.length>1"
                                               ng-click="flagctg=(flagctg?false:true);">
                                                {{(flagctg?"Ver menos":"Ver más...")}}
                                            </a>
                                        </td>
                                        <td>
                                            <span ng-show="item.subcategories.length==0">-</span>

                                            <div ng-repeat="subctg in item.subcategories"
                                                 ng-show="$index==0 || flagsubctg">
                                                {{subctg.name}}
                                            </div>
                                            <a href="javascript:" ng-show="item.subcategories.length>1"
                                               ng-click="flagsubctg=(flagsubctg?false:true);">
                                                {{(flagsubctg?"Ver menos":"Ver más...")}}
                                            </a>
                                        </td>
                                        <td><span>{{item.countVisits}}</span></td>

                                        <td>
                                            <button class="btn btn-primary btn-icon waves-effect waves-circle"
                                                    title="ver Dashboard">
                                                <i class="zmdi zmdi-view-dashboard zmdi-hc-fw"></i></button>
                                        </td>
                                    </tr>
                                    </tbody>
                                </table>
                                <div class="ng-table-pager" style="background: white;">
                                    <uib-pagination boundary-links="true" total-items="vm.pagination.totalItems"
                                                    ng-model="vm.pagination.page"
                                                    class="pagination-sm" max-size="5"
                                                    items-per-page="vm.pagination.pageSize"
                                                    previous-text="<" next-text=">" first-text="<<"
                                                    ng-change="vm.changePage()"
                                                    last-text=">>"></uib-pagination>
                                </div>
                            </div>
                        </tab>
                        <tab heading="Microportales">
                            <div class="table-responsive">
                                <table class="table table-striped table-vmiddle">
                                    <thead>
                                    <tr>
                                        <th>Logo</th>
                                        <th>Nombre</th>
                                        <th>Dominio</th>
                                        <th>Categoría</th>
                                        <th>Sub Categoría</th>
                                        <th>Dashboard</th>
                                    </tr>
                                    <tr>
                                        <td></td>
                                        <td>
                                            <form class="fg-line" ng-submit="vm.searchMp()">
                                                <input type="text"
                                                       class="form-control input-sm"
                                                       ng-model="vm.filtersMp.name.value"/>
                                            </form>
                                        </td>
                                        <td>
                                            <form class="fg-line" ng-submit="vm.searchMp()">
                                                <input type="text"
                                                       class="form-control input-sm"
                                                       ng-model="vm.filtersMp.domain.value">
                                            </form>
                                        </td>
                                        <td>
                                            <form class="fg-line" ng-submit="vm.searchMp()">
                                                <input type="text"
                                                       class="form-control input-sm"
                                                       ng-model="vm.filtersMp.category.value">
                                            </form>
                                        </td>
                                        <td>
                                            <form class="fg-line" ng-submit="vm.searchMp()">
                                                <input type="text"
                                                       class="form-control input-sm"
                                                       ng-model="vm.filtersMp.subcategory.value">
                                            </form>
                                        </td>
                                        <td></td>
                                    </tr>
                                    </thead>
                                    <tbody bs-loading-overlay="mp-table-overlay"
                                           bs-loading-overlay-template-url="overlay-template.html">
                                    <tr>
                                        <td colspan="6" ng-show="vm.flags.serverErrorMp" class="text-center">Hubo un
                                            error
                                            interno
                                        </td>
                                    </tr>
                                    <tr>
                                        <td colspan="6"
                                            ng-show="vm.microportales.length == 0 && !vm.flags.serverErrorMp"
                                            class="text-center">
                                            No se encontraron resultados
                                        </td>
                                    </tr>
                                    <tr ng-repeat="item in vm.microportales" ng-show="!vm.flags.serverErrorMp"
                                        ng-init="flagctgMp=false;flagctgMp=false">
                                        <td>
                                            <img ng-src="{{(item.image_logo!=null?vm.mp_route_img+item.image_logo:(item.categories.length>0?vm.ctg_route_img+item.categories[0].image_logo:null))}}"
                                                 alt=""/>
                                        </td>
                                        <td>{{item.name}}</td>
                                        <td>
                                            <a href="//{{item.fullDomain}}" target="_blank"> {{item.fullDomain}}</a>
                                        </td>
                                        <td>
                                            <span ng-show="item.categories.length==0">-</span>

                                            <div ng-repeat="ctg in item.categories" ng-show="$index==0 || flagctgMp">
                                                {{ctg.name}}
                                            </div>
                                            <a href="javascript:" ng-show="item.categories.length>1"
                                               ng-click="flagctgMp=(flagctgMp?false:true);">
                                                {{(flagctgMp?"Ver menos":"Ver más...")}}
                                            </a>
                                        </td>
                                        <td>
                                            <span ng-show="item.subcategories.length==0">-</span>

                                            <div ng-repeat="subctg in item.subcategories"
                                                 ng-show="$index==0 || flagsubctgMp">
                                                {{subctg.name}}
                                            </div>
                                            <a href="javascript:" ng-show="item.subcategories.length>1"
                                               ng-click="flagsubctgMp=(flagsubctgMp?false:true);">
                                                {{(flagsubctgMp?"Ver menos":"Ver más...")}}
                                            </a>
                                        </td>
                                        <td>
                                            <button class="btn btn-primary btn-icon waves-effect waves-circle"
                                                    title="ver Dashboard">
                                                <i class="zmdi zmdi-view-dashboard zmdi-hc-fw"></i></button>
                                        </td>
                                    </tr>
                                    </tbody>
                                </table>
                                <div class="ng-table-pager" style="background: white;">
                                    <uib-pagination boundary-links="true" total-items="vm.paginationMp.totalItems"
                                                    ng-model="vm.paginationMp.page"
                                                    class="pagination-sm" max-size="5"
                                                    items-per-page="vm.paginationMp.pageSize"
                                                    previous-text="<" next-text=">" first-text="<<"
                                                    ng-change="vm.changePageMp()"
                                                    last-text=">>"></uib-pagination>
                                </div>
                            </div>
                        </tab>
                    </tabset>


                </div>
            </div>


        </div>
    </section>

</section>

<footer id="footer" data-ng-include src="'/template/footer.html'"></footer>


