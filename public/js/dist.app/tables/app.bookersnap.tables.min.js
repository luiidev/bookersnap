
var obtenerIdMicrositio=function(){var url=location.href;var pos=url.indexOf("ms");var id=url.substr(pos+3);var last_pos=id.indexOf("/");id=id.substr(0,last_pos);return id;}
var idMicrositio=obtenerIdMicrositio();angular.module('tables.app',['turn.app','zone.app']).constant("ApiUrl",'http://web.aplication.bookersnap/v1/en/admin/ms/'+idMicrositio+'/mesas');angular.module('turn.app',['turn.controller','turn.service','turn.directive']).config(function($stateProvider,$urlRouterProvider){$stateProvider.state('turn',{url:'/config/turn',templateUrl:'/js/app/tables/turn/view/index.html'}).state('turn.active',{url:'/turn-active',templateUrl:'/js/app/tables/turn/view/turn-active.html'}).state('turn.inactive',{url:'/turn-inactive',templateUrl:'/js/app/tables/turn/view/turn-inactive.html'}).state('turn-create',{url:'/config/turn/new',templateUrl:'/js/app/tables/turn/view/turn-create.html'}).state('turn-edit',{url:'/config/turn/edit',templateUrl:'/js/app/tables/turn/view/turn-edit.html'})});angular.module('turn.controller',[]).controller('TurnCtrl',function($scope){}).controller('TurnCreateCtrl',function($scope){});angular.module('turn.directive',[]);angular.module('turn.service',[]);angular.module('zone.app',['zone.controller','zone.service','zone.directive']).config(function($stateProvider,$urlRouterProvider){$stateProvider.state('zone',{url:'/config/zone',templateUrl:'/js/app/tables/zone/view/index.html'}).state('zone.active',{url:'/zone-active',templateUrl:'/js/app/tables/zone/view/zone-active.html'}).state('zone.inactive',{url:'/zone-inactive',templateUrl:'/js/app/tables/zone/view/zone-inactive.html'}).state('zone-create',{url:'/config/zone/new',templateUrl:'/js/app/tables/zone/view/zone-create.html'}).state('zone-edit',{url:'/config/zone/edit',templateUrl:'/js/app/tables/zone/view/zone-edit.html'})});angular.module('zone.controller',['ngDraggable']).controller('ZoneCtrl',function($scope,ZoneFactory){$scope.zonesActive={};$scope.zonesInactive={};$scope.getZones=function(){ZoneFactory.getZones().success(function(data){var vZonesActive=[];var vZonesInactive=[];angular.forEach(data,function(zones){var zonesTables=getTablesCount(zones);if(zones.status=="0"||zones.status=="2"){vZonesInactive.push(zonesTables);}else{vZonesActive.push(zonesTables);}});$scope.zonesActive=vZonesActive;$scope.zonesInactive=vZonesInactive;});};var getTablesCount=function(zones){var vTables=0;angular.forEach(zones.tables,function(tables){vTables+=1;});zones.tables_count=vTables;return zones;};$scope.getZones();}).controller('ZoneCreateCtrl',function($scope,ZoneFactory){$scope.squareTables1=[];$scope.squareTables2=[];$scope.squareTables3=[];$scope.roundTables1=[];$scope.roundTables2=[];$scope.roundTables3=[];$scope.rectTables1=[];$scope.rectTables2=[];$scope.rectTables3=[];$scope.boxTables={items:true,item:false};$scope.type="";$scope.centerAnchor=true;$scope.toggleCenterAnchor=function(){$scope.centerAnchor=!$scope.centerAnchor};this.alertaPrueba=function(){};$scope.onDragComplete=function(data,evt,type){$scope.type=type;selectTableTypeDrag(data,type);};$scope.onDropComplete=function(data,evt){console.log("drop success, data:"+JSON.stringify(data));selectTableTypeDrop(data,$scope.type);$scope.type="";};$scope.activarTableOptions=function(index,type){getDataTableSelected(index,type);$scope.$apply(function(){$scope.boxTables.item=true;$scope.boxTables.items=false;});};var getDataTableSelected=function(index,type){};var activarTablesItems=function(){$scope.boxTables.item=false;$scope.boxTables.items=true;};$scope.deleteSelectTableItem=function(){angular.element('.item-drag-table').removeClass('selected-table');activarTablesItems();};var selectTableTypeDrag=function(data,type){var index=0;switch(type){case's1':index=$scope.squareTables1.indexOf(data);if(index>-1){$scope.squareTables1.splice(index,1);}
break;case's2':index=$scope.squareTables2.indexOf(data);if(index>-1){$scope.squareTables2.splice(index,1);}
break;case's3':index=$scope.squareTables3.indexOf(data);if(index>-1){$scope.squareTables3.splice(index,1);}
break;case'r1':index=$scope.roundTables1.indexOf(data);if(index>-1){$scope.roundTables1.splice(index,1);}
break;case'r2':index=$scope.roundTables2.indexOf(data);if(index>-1){$scope.roundTables2.splice(index,1);}
break;case'r3':index=$scope.roundTables3.indexOf(data);if(index>-1){$scope.roundTables3.splice(index,1);}
break;case're1':index=$scope.rectTables1.indexOf(data);if(index>-1){$scope.rectTables1.splice(index,1);}
break;case're2':index=$scope.rectTables2.indexOf(data);if(index>-1){$scope.rectTables2.splice(index,1);}
break;case're3':index=$scope.rectTables3.indexOf(data);if(index>-1){$scope.rectTables3.splice(index,1);}
break;}};var selectTableTypeDrop=function(data,type){var index=0;switch(type){case's1':index=$scope.squareTables1.indexOf(data);if(index==-1)
$scope.squareTables1.push(data);break;case's2':index=$scope.squareTables2.indexOf(data);if(index==-1)
$scope.squareTables2.push(data);break;case's3':index=$scope.squareTables3.indexOf(data);if(index==-1)
$scope.squareTables3.push(data);break;case'r1':index=$scope.roundTables1.indexOf(data);if(index==-1)
$scope.roundTables1.push(data);break;case'r2':index=$scope.roundTables2.indexOf(data);if(index==-1)
$scope.roundTables2.push(data);break;case'r3':index=$scope.roundTables3.indexOf(data);if(index==-1)
$scope.roundTables3.push(data);break;case're1':index=$scope.rectTables1.indexOf(data);if(index==-1)
$scope.rectTables1.push(data);break;case're2':index=$scope.rectTables2.indexOf(data);if(index==-1)
$scope.rectTables2.push(data);break;case're3':index=$scope.rectTables3.indexOf(data);if(index==-1)
$scope.rectTables3.push(data);break;default:break;}};});angular.module('zone.directive',[]).directive('ngDragTable',function($document,$window){function makeDraggable(scope,element,attr,ctrl){var startX=0;var startY=0;var x=Math.floor((Math.random()*500)+40);var y=Math.floor((Math.random()*360)+40);element.css({position:'absolute',cursor:'move',top:y+'px',left:x+'px'});element.on('mousedown',function(event){event.preventDefault();startX=event.pageX-x;startY=event.pageY-y;$document.on('mousemove',mousemove);$document.on('mouseup',mouseup);});element.on('click',function(event){event.preventDefault();scope.onClickFn();if(this.classList.contains('selected-table')){this.classList.remove('selected-table');}else{angular.element('.item-drag-table').removeClass('selected-table');this.classList.add('selected-table');}})
function mousemove(event){y=event.pageY-startY;x=event.pageX-startX;element.css({top:y+'px',left:x+'px'});}
function mouseup(){$document.unbind('mousemove',mousemove);$document.unbind('mouseup',mouseup);}}
return{link:makeDraggable,controller:'ZoneCreateCtrl',scope:{onClickFn:'&'}};});angular.module('zone.service',[]).factory('ZoneFactory',function($http,ApiUrl){return{getZones:function(vData){return $http.get(ApiUrl+"/zone");}};});angular.module('bookersnap',['tables.app']);